<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Calculator - Sandrine & Olivier</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            -webkit-font-smoothing: antialiased;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, #dbeafe 0%, #c7d2fe 100%);
        }
        
        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .error-banner {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border: 1px solid #fecaca;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 16px;
        }
        
        .success-banner {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 1px solid #bbf7d0;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 16px;
        }

        .info-banner {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 1px solid #7dd3fc;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 16px;
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading">
            <div>
                <div class="spinner"></div>
                <p class="mt-4 text-gray-600">Budget Calculator laden...</p>
            </div>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        const GOOGLE_CONFIG = {
            API_KEY: 'AIzaSyAYL-9uaenj449Uxv6dCXqA-5Mrazgft-w',
            CLIENT_ID: '429034127132-ouf1as1bgr9qug0odj9bt97j1vjnnp1v.apps.googleusercontent.com',
            DISCOVERY_DOC: 'https://sheets.googleapis.com/$discovery/rest?version=v4',
            SCOPES: 'https://www.googleapis.com/auth/spreadsheets',
            SPREADSHEET_ID: '13V8sTjTH2kYJ6KGWQioRKKuVfrKe05PF9qBXkJOWnFo',
            SHEET_NAME: 'BudgetData'
        };

        function BudgetCalculator() {
            const [activeTab, setActiveTab] = useState('budget');
            const [analysisTab, setAnalysisTab] = useState('together');
            const [isLoading, setIsLoading] = useState(true);
            const [isOnline, setIsOnline] = useState(navigator.onLine);
            const [lastSync, setLastSync] = useState(null);
            const [isGoogleAuthorized, setIsGoogleAuthorized] = useState(false);
            const [googleApiLoaded, setGoogleApiLoaded] = useState(false);
            const [googleTokenClient, setGoogleTokenClient] = useState(null);
            const [syncError, setSyncError] = useState(null);
            const [isSyncing, setIsSyncing] = useState(false);
            const [copiedFromPrevious, setCopiedFromPrevious] = useState(false);

            // Initialize libraries
            useEffect(() => {
                const initLibraries = async () => {
                    console.log('Starting library initialization...');
                    
                    try {
                        if (typeof gapi === 'undefined') {
                            throw new Error('Google API script not loaded');
                        }

                        console.log('Loading Google API client...');
                        
                        await new Promise((resolve, reject) => {
                            gapi.load('client', {
                                callback: () => {
                                    console.log('client module loaded');
                                    resolve();
                                },
                                onerror: (error) => {
                                    console.error('Failed to load client:', error);
                                    reject(new Error('Failed to load client module'));
                                }
                            });
                        });
            
                        console.log('Initializing Google API client...');
                        await gapi.client.init({
                            apiKey: GOOGLE_CONFIG.API_KEY,
                            discoveryDocs: [GOOGLE_CONFIG.DISCOVERY_DOC],
                        });
            
                        console.log('Google API client initialized successfully');
                        setGoogleApiLoaded(true);
                        setSyncError(null);

                        if (typeof google !== 'undefined' && google.accounts) {
                            console.log('Initializing Google Identity Services...');
                            const tokenClient = google.accounts.oauth2.initTokenClient({
                                client_id: GOOGLE_CONFIG.CLIENT_ID,
                                scope: GOOGLE_CONFIG.SCOPES,
                                callback: (response) => {
                                    console.log('OAuth token received:', response);
                                    if (response.access_token) {
                                        gapi.client.setToken({
                                            access_token: response.access_token
                                        });
                                        setIsGoogleAuthorized(true);
                                        loadFromGoogleSheets();
                                    }
                                },
                                error_callback: (error) => {
                                    console.error('OAuth error:', error);
                                    setSyncError(`Authentication error: ${error.type || error.message}`);
                                }
                            });
                            setGoogleTokenClient(tokenClient);
                            console.log('Google Identity Services initialized');
                        } else {
                            throw new Error('Google Identity Services not available');
                        }
                        
                    } catch (error) {
                        console.error('Google API initialization failed:', error);
                        setGoogleApiLoaded(false);
                        setSyncError(`Google API Error: ${error.message}`);
                    }

                    setIsLoading(false);
                };

                setTimeout(initLibraries, 1000);
            }, []);
            
            // Current selected month/year
            const [selectedDate, setSelectedDate] = useState(() => {
                const now = new Date();
                return {
                    month: now.getMonth(),
                    year: now.getFullYear()
                };
            });

            // All data stored per month
            const [monthlyData, setMonthlyData] = useState({});
            const [newExpense, setNewExpense] = useState({
                name: '',
                amount: 0,
                type: 'proportional'
            });

            // Network status monitoring
            useEffect(() => {
                const handleOnline = () => {
                    setIsOnline(true);
                    setSyncError(null);
                };
                const handleOffline = () => {
                    setIsOnline(false);
                    setSyncError('Offline - changes will sync when connection is restored');
                };
                
                window.addEventListener('online', handleOnline);
                window.addEventListener('offline', handleOffline);
                
                return () => {
                    window.removeEventListener('online', handleOnline);
                    window.removeEventListener('offline', handleOffline);
                };
            }, []);

            // Parse sheet data helper function
            const parseSheetData = useCallback((rows) => {
                if (!rows || rows.length <= 1) return {};
                
                const data = {};
                
                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i];
                    if (!row || row.length < 4) continue;
                    
                    const monthName = row[0];
                    const year = row[1];
                    const sandrineIncome = parseFloat(row[2]) || 0;
                    const olivierIncome = parseFloat(row[3]) || 0;
                    const expenseName = row[4] || '';
                    const expenseAmount = parseFloat(row[5]) || 0;
                    const expenseType = row[6] || '';
                    
                    const monthIndex = getMonthIndex(monthName);
                    if (monthIndex === -1) continue;
                    
                    const monthKey = `${year}-${monthIndex.toString().padStart(2, '0')}`;
                    
                    if (!data[monthKey]) {
                        data[monthKey] = {
                            incomes: {
                                person1: { name: 'Sandrine', amount: sandrineIncome },
                                person2: { name: 'Olivier', amount: olivierIncome }
                            },
                            expenses: []
                        };
                    }
                    
                    if (expenseName && expenseAmount > 0) {
                        const existingExpense = data[monthKey].expenses.find(e => e.name === expenseName);
                        if (!existingExpense) {
                            let type = 'proportional';
                            if (expenseType === 'Proportioneel') type = 'proportional';
                            else if (expenseType === 'Fifty-fifty') type = 'fifty-fifty';
                            else if (expenseType === 'Sandrine') type = 'sandrine';
                            else if (expenseType === 'Olivier') type = 'olivier';

                            data[monthKey].expenses.push({
                                id: Date.now() + Math.random(),
                                name: expenseName,
                                amount: expenseAmount,
                                type: type
                            });
                        }
                    }
                }
                
                return data;
            }, []);

            // Load data from Google Sheets
            const loadFromGoogleSheets = useCallback(async () => {
                console.log('loadFromGoogleSheets called');
                
                if (!gapi.client.sheets || !gapi.client.getToken()) {
                    console.log('Cannot load from Google Sheets: client not ready or no token');
                    return;
                }

                try {
                    console.log('Loading data from Google Sheets...');
                    setIsSyncing(true);
                    setSyncError(null);
                    
                    const response = await gapi.client.sheets.spreadsheets.values.get({
                        spreadsheetId: GOOGLE_CONFIG.SPREADSHEET_ID,
                        range: `${GOOGLE_CONFIG.SHEET_NAME}!A:H`
                    });
        
                    if (response.result.values && response.result.values.length > 1) {
                        const sheetData = parseSheetData(response.result.values);
                        setMonthlyData(sheetData);
                        setLastSync(new Date().toISOString());
                        console.log('Data loaded successfully from Google Sheets');
                    } else {
                        console.log('No data found in Google Sheets');
                    }
                } catch (error) {
                    console.error('Failed to load from Google Sheets:', error);
                    setSyncError(`Failed to load data: ${error.message}`);
                } finally {
                    setIsSyncing(false);
                }
            }, [parseSheetData]);

            // Convert our data format to sheet format
            const convertToSheetFormat = useCallback(() => {
                const sheetData = [
                    ['Maand', 'Jaar', 'Sandrine Inkomen', 'Olivier Inkomen', 'Uitgave Naam', 'Uitgave Bedrag', 'Uitgave Type', 'Update Tijd']
                ];

                Object.entries(monthlyData).forEach(([monthKey, data]) => {
                    const [year, month] = monthKey.split('-');
                    const monthName = getMonthName(parseInt(month));

                    if (data.expenses.length === 0) {
                        sheetData.push([
                            monthName, year,
                            data.incomes.person1.amount, data.incomes.person2.amount,
                            '', '', '', new Date().toISOString()
                        ]);
                    } else {
                        data.expenses.forEach(expense => {
                            let typeDisplayName = '';
                            if (expense.type === 'proportional') typeDisplayName = 'Proportioneel';
                            else if (expense.type === 'fifty-fifty') typeDisplayName = 'Fifty-fifty';
                            else if (expense.type === 'sandrine') typeDisplayName = 'Sandrine';
                            else if (expense.type === 'olivier') typeDisplayName = 'Olivier';

                            sheetData.push([
                                monthName, year,
                                data.incomes.person1.amount, data.incomes.person2.amount,
                                expense.name, expense.amount,
                                typeDisplayName,
                                new Date().toISOString()
                            ]);
                        });
                    }
                });

                return sheetData;
            }, [monthlyData]);

            // Save data to Google Sheets
            const saveToGoogleSheets = useCallback(async () => {
                if (!isGoogleAuthorized || !gapi.client.sheets || !isOnline) {
                    console.log('Cannot save to Google Sheets: not authorized, client not ready, or offline');
                    return;
                }

                try {
                    console.log('Saving data to Google Sheets...');
                    setIsSyncing(true);
                    setSyncError(null);
                    
                    const values = convertToSheetFormat();
        
                    await gapi.client.sheets.spreadsheets.values.clear({
                        spreadsheetId: GOOGLE_CONFIG.SPREADSHEET_ID,
                        range: GOOGLE_CONFIG.SHEET_NAME
                    });

                    await gapi.client.sheets.spreadsheets.values.update({
                        spreadsheetId: GOOGLE_CONFIG.SPREADSHEET_ID,
                        range: `${GOOGLE_CONFIG.SHEET_NAME}!A1`,
                        valueInputOption: 'RAW',
                        resource: { values }
                    });

                    setLastSync(new Date().toISOString());
                    console.log('Data saved successfully to Google Sheets');
                } catch (error) {
                    console.error('Failed to save to Google Sheets:', error);
                    setSyncError(`Failed to save data: ${error.message}`);
                } finally {
                    setIsSyncing(false);
                }
            }, [isGoogleAuthorized, isOnline, convertToSheetFormat]);

            // Auto-sync to Google Sheets when data changes
            useEffect(() => {
                if (isGoogleAuthorized && Object.keys(monthlyData).length > 0 && isOnline) {
                    const timeoutId = setTimeout(() => {
                        saveToGoogleSheets();
                    }, 3000);

                    return () => clearTimeout(timeoutId);
                }
            }, [monthlyData, isGoogleAuthorized, isOnline, saveToGoogleSheets]);

            const signInToGoogle = useCallback(async () => {
                try {
                    console.log('Attempting Google sign-in...');
                    setSyncError(null);
                    
                    if (googleTokenClient) {
                        googleTokenClient.requestAccessToken();
                    } else {
                        throw new Error('Google token client not initialized');
                    }
                } catch (error) {
                    console.error('Google sign-in failed:', error);
                    setSyncError(`Sign-in failed: ${error.message}`);
                }
            }, [googleTokenClient]);

            const signOutFromGoogle = useCallback(async () => {
                try {
                    if (google.accounts.oauth2 && gapi.client.getToken()) {
                        google.accounts.oauth2.revoke(gapi.client.getToken().access_token, () => {
                            console.log('Token revoked');
                        });
                    }
                    gapi.client.setToken(null);
                    setIsGoogleAuthorized(false);
                    setLastSync(null);
                    setSyncError(null);
                    console.log('Google sign-out successful');
                } catch (error) {
                    console.error('Google sign-out failed:', error);
                    setIsGoogleAuthorized(false);
                    setLastSync(null);
                }
            }, []);

            // Utility functions
            const getCurrentMonthKey = useCallback(() => {
                return `${selectedDate.year}-${selectedDate.month.toString().padStart(2, '0')}`;
            }, [selectedDate]);

            const getPreviousMonthKey = useCallback(() => {
                let prevMonth = selectedDate.month - 1;
                let prevYear = selectedDate.year;
                
                if (prevMonth < 0) {
                    prevMonth = 11;
                    prevYear -= 1;
                }
                
                return `${prevYear}-${prevMonth.toString().padStart(2, '0')}`;
            }, [selectedDate]);

            const getCurrentMonthData = useCallback(() => {
                const monthKey = getCurrentMonthKey();
                return monthlyData[monthKey] || {
                    incomes: {
                        person1: { name: 'Sandrine', amount: 0 },
                        person2: { name: 'Olivier', amount: 0 }
                    },
                    expenses: []
                };
            }, [monthlyData, getCurrentMonthKey]);

            const updateCurrentMonthData = useCallback((updates) => {
                const monthKey = getCurrentMonthKey();
                setMonthlyData(prev => ({
                    ...prev,
                    [monthKey]: {
                        ...getCurrentMonthData(),
                        ...updates
                    }
                }));
            }, [getCurrentMonthKey, getCurrentMonthData]);

            // Copy expenses from previous month
            const copyExpensesFromPreviousMonth = useCallback(() => {
                const currentMonthKey = getCurrentMonthKey();
                const previousMonthKey = getPreviousMonthKey();
                
                const currentMonthData = monthlyData[currentMonthKey];
                const previousMonthData = monthlyData[previousMonthKey];
                
                if ((!currentMonthData || currentMonthData.expenses.length === 0) && 
                    previousMonthData && previousMonthData.expenses.length > 0) {
                    
                    const copiedExpenses = previousMonthData.expenses.map(expense => ({
                        ...expense,
                        id: Date.now() + Math.random()
                    }));
                    
                    updateCurrentMonthData({
                        expenses: copiedExpenses
                    });
                    
                    setCopiedFromPrevious(true);
                    setTimeout(() => setCopiedFromPrevious(false), 5000);
                    
                    console.log(`Copied ${copiedExpenses.length} expenses from previous month`);
                }
            }, [getCurrentMonthKey, getPreviousMonthKey, monthlyData, updateCurrentMonthData]);

            // Auto-copy expenses when month changes or data is loaded
            useEffect(() => {
                if (Object.keys(monthlyData).length > 0) {
                    copyExpensesFromPreviousMonth();
                }
            }, [selectedDate, monthlyData, copyExpensesFromPreviousMonth]);

            const navigateMonth = useCallback((direction) => {
                setSelectedDate(prev => {
                    let newMonth = prev.month + direction;
                    let newYear = prev.year;
                    
                    if (newMonth > 11) {
                        newMonth = 0;
                        newYear += 1;
                    } else if (newMonth < 0) {
                        newMonth = 11;
                        newYear -= 1;
                    }
                    
                    return { month: newMonth, year: newYear };
                });
            }, []);

            const getMonthName = useCallback((monthIndex) => {
                const months = [
                    'Januari', 'Februari', 'Maart', 'April', 'Mei', 'Juni',
                    'Juli', 'Augustus', 'September', 'Oktober', 'November', 'December'
                ];
                return months[monthIndex];
            }, []);

            const getMonthIndex = useCallback((monthName) => {
                const months = [
                    'Januari', 'Februari', 'Maart', 'April', 'Mei', 'Juni',
                    'Juli', 'Augustus', 'September', 'Oktober', 'November', 'December'
                ];
                return months.indexOf(monthName);
            }, []);

            const updateIncome = useCallback((person, amount) => {
                const currentData = getCurrentMonthData();
                const newIncomes = {
                    ...currentData.incomes,
                    [person]: { ...currentData.incomes[person], amount: parseFloat(amount) || 0 }
                };
                updateCurrentMonthData({ incomes: newIncomes });
            }, [getCurrentMonthData, updateCurrentMonthData]);

            const addExpense = useCallback(() => {
                if (newExpense.name && newExpense.amount > 0) {
                    const currentData = getCurrentMonthData();
                    const newExpenses = [...currentData.expenses, { ...newExpense, id: Date.now() }];
                    updateCurrentMonthData({ expenses: newExpenses });
                    setNewExpense({ name: '', amount: 0, type: 'proportional' });
                }
            }, [newExpense, getCurrentMonthData, updateCurrentMonthData]);

            const deleteExpense = useCallback((id) => {
                const currentData = getCurrentMonthData();
                const newExpenses = currentData.expenses.filter(exp => exp.id !== id);
                updateCurrentMonthData({ expenses: newExpenses });
            }, [getCurrentMonthData, updateCurrentMonthData]);

            const currentData = getCurrentMonthData();
            const incomes = currentData.incomes;
            const expenses = currentData.expenses;

            // Calculations
            const bothIncomesEntered = incomes.person1.amount > 0 && incomes.person2.amount > 0;
            const totalIncome = incomes.person1.amount + incomes.person2.amount;
            const person1Ratio = totalIncome > 0 ? incomes.person1.amount / totalIncome : 0.5;
            const person2Ratio = totalIncome > 0 ? incomes.person2.amount / totalIncome : 0.5;

            const proportionalExpenses = expenses.filter(exp => exp.type === 'proportional');
            const fixedExpenses = expenses.filter(exp => exp.type === 'fifty-fifty');
            const sandrineExpenses = expenses.filter(exp => exp.type === 'sandrine');
            const olivierExpenses = expenses.filter(exp => exp.type === 'olivier');

            const totalProportionalExpenses = proportionalExpenses.reduce((sum, exp) => sum + exp.amount, 0);
            const totalFixedExpenses = fixedExpenses.reduce((sum, exp) => sum + exp.amount, 0);
            const totalSandrineExpenses = sandrineExpenses.reduce((sum, exp) => sum + exp.amount, 0);
            const totalOlivierExpenses = olivierExpenses.reduce((sum, exp) => sum + exp.amount, 0);

            const person1ProportionalShare = totalProportionalExpenses * person1Ratio;
            const person2ProportionalShare = totalProportionalExpenses * person2Ratio;
            const person1FixedShare = totalFixedExpenses / 2;
            const person2FixedShare = totalFixedExpenses / 2;
            
            const person1Total = person1ProportionalShare + person1FixedShare + totalSandrineExpenses;
            const person2Total = person2ProportionalShare + person2FixedShare + totalOlivierExpenses;

            // Analysis data
            const getAnalysisData = useCallback(() => {
                return Object.entries(monthlyData)
                    .sort(([a], [b]) => a.localeCompare(b))
                    .map(([monthKey, data]) => {
                        const [year, month] = monthKey.split('-');
                        const monthName = getMonthName(parseInt(month));
                        
                        const totalIncome = data.incomes.person1.amount + data.incomes.person2.amount;
                        const totalExpenses = data.expenses.reduce((sum, exp) => sum + exp.amount, 0);
                        
                        const proportionalExpenses = data.expenses.filter(e => e.type === 'proportional').reduce((sum, e) => sum + e.amount, 0);
                        const fiftyFiftyExpenses = data.expenses.filter(e => e.type === 'fifty-fifty').reduce((sum, e) => sum + e.amount, 0);
                        const sandrineOnlyExpenses = data.expenses.filter(e => e.type === 'sandrine').reduce((sum, e) => sum + e.amount, 0);
                        const olivierOnlyExpenses = data.expenses.filter(e => e.type === 'olivier').reduce((sum, e) => sum + e.amount, 0);
                        
                        const sandrineRatio = totalIncome > 0 ? data.incomes.person1.amount / totalIncome : 0.5;
                        const olivierRatio = totalIncome > 0 ? data.incomes.person2.amount / totalIncome : 0.5;
                        
                        const sandrineExpenses = (proportionalExpenses * sandrineRatio) + (fiftyFiftyExpenses / 2) + sandrineOnlyExpenses;
                        const olivierExpenses = (proportionalExpenses * olivierRatio) + (fiftyFiftyExpenses / 2) + olivierOnlyExpenses;
                        
                        return {
                            monthKey,
                            monthName: `${monthName.slice(0, 3)} ${year}`,
                            fullMonth: `${monthName} ${year}`,
                            sandrineIncome: data.incomes.person1.amount,
                            olivierIncome: data.incomes.person2.amount,
                            totalIncome,
                            totalExpenses,
                            savings: totalIncome - totalExpenses,
                            sandrineRatio: sandrineRatio * 100,
                            olivierRatio: olivierRatio * 100,
                            sandrineExpenses,
                            olivierExpenses,
                            sandrineSavings: data.incomes.person1.amount - sandrineExpenses,
                            olivierSavings: data.incomes.person2.amount - olivierExpenses
                        };
                    });
            }, [monthlyData, getMonthName]);

            const analysisData = getAnalysisData();

            if (isLoading) {
                return (
                    <div className="loading">
                        <div>
                            <div className="spinner"></div>
                            <p className="mt-4 text-gray-600">Data laden...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="max-w-6xl mx-auto p-6 bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
                    <div className="bg-white rounded-xl shadow-lg overflow-hidden">
                        {/* Header */}
                        <div className="gradient-bg p-6 text-white">
                            <div className="flex justify-between items-start mb-6">
                                <div>
                                    <h1 className="text-3xl font-bold">Budget Calculator</h1>
                                    <p className="text-indigo-100">Sandrine & Olivier</p>
                                </div>
                                
                                {/* Status Indicators */}
                                <div className="flex flex-col items-end gap-2">
                                    <div className={`flex items-center gap-2 px-3 py-1 rounded-full text-sm ${
                                        isOnline ? 'bg-green-500/20 text-green-100' : 'bg-red-500/20 text-red-100'
                                    }`}>
                                        <div className={`w-2 h-2 rounded-full ${isOnline ? 'bg-green-400' : 'bg-red-400'}`}></div>
                                        {isOnline ? 'Online' : 'Offline'}
                                    </div>
                                    
                                    {isSyncing && (
                                        <div className="flex items-center gap-2 px-3 py-1 rounded-full text-sm bg-blue-500/20 text-blue-100">
                                            <div className="w-2 h-2 rounded-full bg-blue-400 animate-pulse"></div>
                                            Syncing...
                                        </div>
                                    )}
                                    
                                    {lastSync && !isSyncing && (
                                        <div className="text-xs text-indigo-200">
                                            Laatste sync: {new Date(lastSync).toLocaleString('nl-NL')}
                                        </div>
                                    )}

                                    {isGoogleAuthorized ? (
                                        <button
                                            onClick={signOutFromGoogle}
                                            className="px-3 py-1 bg-red-600/80 text-white rounded text-xs hover:bg-red-600 transition-colors"
                                        >
                                            Disconnect Google
                                        </button>
                                    ) : googleApiLoaded ? (
                                        <button
                                            onClick={signInToGoogle}
                                            className="px-3 py-1 bg-green-600/80 text-white rounded text-xs hover:bg-green-600 transition-colors"
                                        >
                                            Connect Google Sheets
                                        </button>
                                    ) : (
                                        <div className="text-xs text-indigo-200">
                                            Google Sheets: Loading...
                                        </div>
                                    )}
                                </div>
                            </div>
                            
                            {/* Tab Navigation */}
                            <div className="flex justify-center space-x-1 bg-white/10 backdrop-blur-sm rounded-lg p-1">
                                <button
                                    onClick={() => setActiveTab('budget')}
                                    className={`flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition-all duration-300 ${
                                        activeTab === 'budget' 
                                            ? 'bg-white text-indigo-600 shadow-lg' 
                                            : 'text-white hover:bg-white/20'
                                    }`}
                                >
                                    Budget
                                </button>
                                <button
                                    onClick={() => setActiveTab('analysis')}
                                    className={`flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition-all duration-300 ${
                                        activeTab === 'analysis' 
                                            ? 'bg-white text-indigo-600 shadow-lg' 
                                            : 'text-white hover:bg-white/20'
                                    }`}
                                >
                                    Analyse
                                </button>
                            </div>
                        </div>

                        <div className="p-8">
                            {/* Error/Success Messages */}
                            {syncError && (
                                <div className="error-banner">
                                    <div className="flex items-center gap-2">
                                        <div className="text-red-600 text-xl">‚ö†Ô∏è</div>
                                        <div>
                                            <div className="font-medium text-red-800">Sync probleem</div>
                                            <div className="text-sm text-red-600">{syncError}</div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {isGoogleAuthorized && !syncError && lastSync && (
                                <div className="success-banner">
                                    <div className="flex items-center gap-2">
                                        <div className="text-green-600 text-xl">‚úÖ</div>
                                        <div>
                                            <div className="font-medium text-green-800">Google Sheets verbonden</div>
                                            <div className="text-sm text-green-600">Data wordt automatisch gesynchroniseerd</div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Copy from Previous Month Notification */}
                            {copiedFromPrevious && (
                                <div className="info-banner">
                                    <div className="flex items-center gap-2">
                                        <div className="text-blue-600 text-xl">üìã</div>
                                        <div>
                                            <div className="font-medium text-blue-800">Uitgaven gekopieerd</div>
                                            <div className="text-sm text-blue-600">
                                                De uitgaven van de vorige maand zijn automatisch gekopieerd. 
                                                Je kunt deze naar belieben aanpassen of verwijderen.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'budget' ? (
                                <>
                                    {/* Month Navigation */}
                                    <div className="mb-8 p-4 sm:p-6 bg-indigo-50 rounded-lg">
                                        <div className="flex items-center justify-between gap-2">
                                            <button
                                                onClick={() => navigateMonth(-1)}
                                                className="flex items-center gap-1 sm:gap-2 px-2 sm:px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors text-sm sm:text-base flex-shrink-0"
                                            >
                                                <span className="hidden xs:inline">‚Üê Vorige</span>
                                                <span className="xs:hidden">‚Üê</span>
                                            </button>
                                            
                                            <div className="text-center flex-1 min-w-0 px-2">
                                                <h2 className="text-lg sm:text-2xl font-bold text-gray-800 truncate">
                                                    {getMonthName(selectedDate.month)} {selectedDate.year}
                                                </h2>
                                                {Object.keys(monthlyData).includes(getCurrentMonthKey()) && (
                                                    <div className="text-xs sm:text-sm text-green-600 font-medium mt-1">
                                                        ‚úì Data opgeslagen
                                                    </div>
                                                )}
                                            </div>
                                            
                                            <button
                                                onClick={() => navigateMonth(1)}
                                                className="flex items-center gap-1 sm:gap-2 px-2 sm:px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors text-sm sm:text-base flex-shrink-0"
                                            >
                                                <span className="hidden xs:inline">Volgende ‚Üí</span>
                                                <span className="xs:hidden">‚Üí</span>
                                            </button>
                                        </div>
                                    </div>

                                    {/* Income Section */}
                                    <div className="mb-8 p-6 bg-green-50 rounded-lg">
                                        <h2 className="text-xl font-semibold text-gray-700 mb-4">
                                            Inkomsten voor {getMonthName(selectedDate.month)} {selectedDate.year}
                                        </h2>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-600 mb-2">
                                                    Sandrine
                                                </label>
                                                <input
                                                    type="number"
                                                    value={incomes.person1.amount || ''}
                                                    onChange={(e) => updateIncome('person1', e.target.value)}
                                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                                    placeholder="‚Ç¨ 0,00"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-600 mb-2">
                                                    Olivier
                                                </label>
                                                <input
                                                    type="number"
                                                    value={incomes.person2.amount || ''}
                                                    onChange={(e) => updateIncome('person2', e.target.value)}
                                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                                    placeholder="‚Ç¨ 0,00"
                                                />
                                            </div>
                                        </div>
                                        <div className="mt-4 p-3 bg-white rounded-lg">
                                            {bothIncomesEntered ? (
                                                <>
                                                    <div className="text-sm text-gray-600">
                                                        Totaal inkomen: <span className="font-semibold">‚Ç¨{totalIncome.toFixed(2)}</span>
                                                    </div>
                                                    <div className="text-sm text-gray-600">
                                                        Verhouding: Sandrine {Math.round(person1Ratio * 100)}% | Olivier {Math.round(person2Ratio * 100)}%
                                                    </div>
                                                </>
                                            ) : (
                                                <div className="text-sm text-yellow-600 font-medium">
                                                    ‚ö†Ô∏è Vul beide lonen in om de verhouding te berekenen
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    {/* Add Expense Section */}
                                    <div className="mb-8 p-6 bg-yellow-50 rounded-lg">
                                        <h2 className="text-xl font-semibold text-gray-700 mb-4">Nieuwe Uitgave Toevoegen</h2>
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            <input
                                                type="text"
                                                value={newExpense.name}
                                                onChange={(e) => setNewExpense({...newExpense, name: e.target.value})}
                                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                                placeholder="Uitgave naam"
                                            />
                                            <input
                                                type="number"
                                                value={newExpense.amount || ''}
                                                onChange={(e) => setNewExpense({...newExpense, amount: parseFloat(e.target.value) || 0})}
                                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                                placeholder="‚Ç¨ 0,00"
                                            />
                                            <div className="grid grid-cols-2 gap-2">
                                                <label className="flex items-center gap-1">
                                                    <input
                                                        type="radio"
                                                        checked={newExpense.type === 'proportional'}
                                                        onChange={() => setNewExpense({...newExpense, type: 'proportional'})}
                                                        className="text-yellow-600"
                                                    />
                                                    <span className="text-xs">Proportioneel</span>
                                                </label>
                                                <label className="flex items-center gap-1">
                                                    <input
                                                        type="radio"
                                                        checked={newExpense.type === 'fifty-fifty'}
                                                        onChange={() => setNewExpense({...newExpense, type: 'fifty-fifty'})}
                                                        className="text-yellow-600"
                                                    />
                                                    <span className="text-xs">50/50</span>
                                                </label>
                                                <label className="flex items-center gap-1">
                                                    <input
                                                        type="radio"
                                                        checked={newExpense.type === 'sandrine'}
                                                        onChange={() => setNewExpense({...newExpense, type: 'sandrine'})}
                                                        className="text-yellow-600"
                                                    />
                                                    <span className="text-xs">Sandrine</span>
                                                </label>
                                                <label className="flex items-center gap-1">
                                                    <input
                                                        type="radio"
                                                        checked={newExpense.type === 'olivier'}
                                                        onChange={() => setNewExpense({...newExpense, type: 'olivier'})}
                                                        className="text-yellow-600"
                                                    />
                                                    <span className="text-xs">Olivier</span>
                                                </label>
                                            </div>
                                        </div>
                                        <button
                                            onClick={addExpense}
                                            className="mt-4 flex items-center gap-2 px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors"
                                        >
                                            + Uitgave Toevoegen
                                        </button>
                                    </div>

                                    {/* Manual Copy Button */}
                                    {(() => {
                                        const currentMonthKey = getCurrentMonthKey();
                                        const previousMonthKey = getPreviousMonthKey();
                                        const currentMonthData = monthlyData[currentMonthKey];
                                        const previousMonthData = monthlyData[previousMonthKey];
                                        const hasCurrentExpenses = currentMonthData && currentMonthData.expenses.length > 0;
                                        const hasPreviousExpenses = previousMonthData && previousMonthData.expenses.length > 0;
                                        
                                        if (hasPreviousExpenses && hasCurrentExpenses) {
                                            return (
                                                <div className="mb-8 p-4 bg-blue-50 rounded-lg">
                                                    <div className="flex items-center justify-between">
                                                        <div>
                                                            <div className="font-medium text-blue-800">Uitgaven van vorige maand</div>
                                                            <div className="text-sm text-blue-600">
                                                                Je kunt de uitgaven van {getMonthName((selectedDate.month - 1 + 12) % 12)} opnieuw kopi√´ren als je dat wilt.
                                                            </div>
                                                        </div>
                                                        <button
                                                            onClick={copyExpensesFromPreviousMonth}
                                                            className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"
                                                        >
                                                            üìã Kopieer opnieuw
                                                        </button>
                                                    </div>
                                                </div>
                                            );
                                        }
                                        return null;
                                    })()}

                                    {/* Expenses List */}
                                    <div className="mb-8">
                                        <h2 className="text-xl font-semibold text-gray-700 mb-4">
                                            Uitgaven voor {getMonthName(selectedDate.month)} {selectedDate.year}
                                        </h2>
                                        {expenses.length === 0 ? (
                                            <div className="text-center py-8 text-gray-500 bg-gray-50 rounded-lg">
                                                Nog geen uitgaven toegevoegd voor deze maand
                                            </div>
                                        ) : (
                                            <div className="space-y-3">
                                                {expenses.map((expense) => (
                                                    <div key={expense.id} className="p-4 bg-white border border-gray-200 rounded-lg shadow-sm">
                                                        <div className="flex items-center justify-between">
                                                            <div className="flex-1">
                                                                <div className="font-medium text-gray-800">{expense.name}</div>
                                                                <div className="text-sm text-gray-600">
                                                                    ‚Ç¨{expense.amount.toFixed(2)} - {
                                                                        expense.type === 'proportional' ? 'Proportioneel' :
                                                                        expense.type === 'fifty-fifty' ? 'Fifty-fifty' :
                                                                        expense.type === 'sandrine' ? 'Sandrine (individueel)' :
                                                                        'Olivier (individueel)'
                                                                    }
                                                                </div>
                                                            </div>
                                                            <button
                                                                onClick={() => deleteExpense(expense.id)}
                                                                className="p-2 text-red-600 hover:bg-red-100 rounded transition-colors"
                                                            >
                                                                Verwijder
                                                            </button>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>

                                    {/* Results Section */}
                                    {bothIncomesEntered ? (
                                        <div className="mb-8 p-6 bg-blue-50 rounded-lg">
                                            <h2 className="text-xl font-semibold text-gray-700 mb-4">Berekening</h2>
                                            
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                <div className="bg-white p-6 rounded-lg shadow-sm">
                                                    <h3 className="font-semibold text-blue-600 mb-3 text-lg">Sandrine</h3>
                                                    <div className="space-y-2 text-sm">
                                                        <div className="flex justify-between">
                                                            <span>Proportionele uitgaven:</span>
                                                            <span>‚Ç¨{person1ProportionalShare.toFixed(2)}</span>
                                                        </div>
                                                        <div className="flex justify-between">
                                                            <span>Fifty-fifty uitgaven:</span>
                                                            <span>‚Ç¨{person1FixedShare.toFixed(2)}</span>
                                                        </div>
                                                        <div className="flex justify-between">
                                                            <span>Individuele uitgaven:</span>
                                                            <span>‚Ç¨{totalSandrineExpenses.toFixed(2)}</span>
                                                        </div>
                                                        <hr className="my-2" />
                                                        <div className="flex justify-between font-semibold text-lg">
                                                            <span>Totaal te storten:</span>
                                                            <span className="text-blue-600">‚Ç¨{person1Total.toFixed(2)}</span>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div className="bg-white p-6 rounded-lg shadow-sm">
                                                    <h3 className="font-semibold text-green-600 mb-3 text-lg">Olivier</h3>
                                                    <div className="space-y-2 text-sm">
                                                        <div className="flex justify-between">
                                                            <span>Proportionele uitgaven:</span>
                                                            <span>‚Ç¨{person2ProportionalShare.toFixed(2)}</span>
                                                        </div>
                                                        <div className="flex justify-between">
                                                            <span>Fifty-fifty uitgaven:</span>
                                                            <span>‚Ç¨{person2FixedShare.toFixed(2)}</span>
                                                        </div>
                                                        <div className="flex justify-between">
                                                            <span>Individuele uitgaven:</span>
                                                            <span>‚Ç¨{totalOlivierExpenses.toFixed(2)}</span>
                                                        </div>
                                                        <hr className="my-2" />
                                                        <div className="flex justify-between font-semibold text-lg">
                                                            <span>Totaal te storten:</span>
                                                            <span className="text-green-600">‚Ç¨{person2Total.toFixed(2)}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div className="mt-6 p-4 bg-white rounded-lg text-center">
                                                <div className="text-sm text-gray-600 mb-2">Totale maandelijkse uitgaven</div>
                                                <div className="text-2xl font-bold text-gray-800">
                                                    ‚Ç¨{(totalProportionalExpenses + totalFixedExpenses + totalSandrineExpenses + totalOlivierExpenses).toFixed(2)}
                                                </div>
                                                <div className="text-sm text-purple-600 font-medium mt-2">
                                                    Potenti√´le besparingen: ‚Ç¨{(totalIncome - (totalProportionalExpenses + totalFixedExpenses + totalSandrineExpenses + totalOlivierExpenses)).toFixed(2)}
                                                </div>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="mb-8 p-6 bg-gray-100 rounded-lg text-center">
                                            <h2 className="text-xl font-semibold text-gray-500 mb-4">Berekening</h2>
                                            <div className="py-8">
                                                <div className="text-6xl mb-4">üßÆ</div>
                                                <div className="text-gray-500 mb-2">
                                                    Vul eerst beide lonen in om de berekening te zien
                                                </div>
                                                <div className="text-sm text-gray-400">
                                                    De verdeling wordt automatisch berekend zodra beide bedragen zijn ingevuld
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </>
                            ) : (
                                <div className="space-y-8">
                                    {/* Analysis Sub-tabs */}
                                    <div className="bg-gray-50 p-6 rounded-xl">
                                        <div className="flex justify-center space-x-1 bg-white rounded-lg p-1 mb-6">
                                            <button
                                                onClick={() => setAnalysisTab('together')}
                                                className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all duration-300 ${
                                                    analysisTab === 'together' 
                                                        ? 'bg-indigo-600 text-white shadow-lg' 
                                                        : 'text-gray-600 hover:bg-gray-100'
                                                }`}
                                            >
                                                üíë Samen
                                            </button>
                                            <button
                                                onClick={() => setAnalysisTab('sandrine')}
                                                className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all duration-300 ${
                                                    analysisTab === 'sandrine' 
                                                        ? 'bg-blue-600 text-white shadow-lg' 
                                                        : 'text-gray-600 hover:bg-gray-100'
                                                }`}
                                            >
                                                üë©‚Äçüíº Sandrine
                                            </button>
                                            <button
                                                onClick={() => setAnalysisTab('olivier')}
                                                className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all duration-300 ${
                                                    analysisTab === 'olivier' 
                                                        ? 'bg-green-600 text-white shadow-lg' 
                                                        : 'text-gray-600 hover:bg-gray-100'
                                                }`}
                                            >
                                                üë®‚Äçüíº Olivier
                                            </button>
                                        </div>

                                        {/* Analysis Content */}
                                        {analysisTab === 'together' && (
                                            <div className="space-y-6">
                                                {/* Together Overview */}
                                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                                    <div className="bg-gradient-to-br from-purple-500 to-purple-600 p-6 rounded-xl text-white">
                                                        <div className="text-3xl mb-2">üí∞</div>
                                                        <div className="text-2xl font-bold">
                                                            ‚Ç¨{analysisData.length > 0 ? (analysisData.reduce((sum, d) => sum + d.totalIncome, 0) / analysisData.length).toFixed(0) : '0'}
                                                        </div>
                                                        <div className="text-purple-100 text-sm">Gem. Maandinkomen</div>
                                                    </div>
                                                    
                                                    <div className="bg-gradient-to-br from-amber-500 to-amber-600 p-6 rounded-xl text-white">
                                                        <div className="text-3xl mb-2">üõí</div>
                                                        <div className="text-2xl font-bold">
                                                            ‚Ç¨{analysisData.length > 0 ? (analysisData.reduce((sum, d) => sum + d.totalExpenses, 0) / analysisData.length).toFixed(0) : '0'}
                                                        </div>
                                                        <div className="text-amber-100 text-sm">Gem. Maanduitgaven</div>
                                                    </div>
                                                    
                                                    <div className="bg-gradient-to-br from-green-500 to-green-600 p-6 rounded-xl text-white">
                                                        <div className="text-3xl mb-2">üíé</div>
                                                        <div className="text-2xl font-bold">
                                                            ‚Ç¨{analysisData.length > 0 ? (analysisData.reduce((sum, d) => sum + d.savings, 0) / analysisData.length).toFixed(0) : '0'}
                                                        </div>
                                                        <div className="text-green-100 text-sm">Gem. Besparingen</div>
                                                    </div>
                                                    
                                                    <div className="bg-gradient-to-br from-blue-500 to-blue-600 p-6 rounded-xl text-white">
                                                        <div className="text-3xl mb-2">üìä</div>
                                                        <div className="text-2xl font-bold">
                                                            {analysisData.length}
                                                        </div>
                                                        <div className="text-blue-100 text-sm">
                                                            {analysisData.length === 1 ? 'Maand' : 'Maanden'} Data
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* Together Data Table */}
                                                {analysisData.length > 0 ? (
                                                    <div className="bg-white p-6 rounded-xl shadow-lg">
                                                        <h4 className="text-lg font-semibold mb-4">Samen - Maandelijkse Data</h4>
                                                        <div className="overflow-x-auto">
                                                            <table className="w-full text-sm">
                                                                <thead className="bg-gray-50">
                                                                    <tr>
                                                                        <th className="text-left p-3 font-semibold">Maand</th>
                                                                        <th className="text-right p-3 font-semibold">Totaal Inkomen</th>
                                                                        <th className="text-right p-3 font-semibold">Totale Uitgaven</th>
                                                                        <th className="text-right p-3 font-semibold">Besparingen</th>
                                                                        <th className="text-right p-3 font-semibold">Spaarpercentage</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    {analysisData.slice().reverse().map((month, index) => (
                                                                        <tr key={month.monthKey} className={index % 2 === 0 ? 'bg-gray-50/50' : ''}>
                                                                            <td className="p-3 font-medium">{month.fullMonth}</td>
                                                                            <td className="p-3 text-right">‚Ç¨{month.totalIncome.toFixed(2)}</td>
                                                                            <td className="p-3 text-right text-red-600">‚Ç¨{month.totalExpenses.toFixed(2)}</td>
                                                                            <td className={`p-3 text-right font-semibold ${month.savings >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                                                                ‚Ç¨{month.savings.toFixed(2)}
                                                                            </td>
                                                                            <td className={`p-3 text-right ${(month.savings / month.totalIncome * 100) >= 10 ? 'text-green-600' : 'text-amber-600'}`}>
                                                                                {month.totalIncome > 0 ? (month.savings / month.totalIncome * 100).toFixed(1) : '0'}%
                                                                            </td>
                                                                        </tr>
                                                                    ))}
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                ) : null}
                                            </div>
                                        )}

                                        {analysisTab === 'sandrine' && (
                                            <div className="space-y-6">
                                                {/* Sandrine Overview */}
                                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                                    <div className="bg-gradient-to-br from-blue-500 to-blue-600 p-6 rounded-xl text-white">
                                                        <div className="text-3xl mb-2">üí∞</div>
                                                        <div className="text-2xl font-bold">
                                                            ‚Ç¨{analysisData.length > 0 ? (analysisData.reduce((sum, d) => sum + d.sandrineIncome, 0) / analysisData.length).toFixed(0) : '0'}
                                                        </div>
                                                        <div className="text-blue-100 text-sm">Gem. Maandinkomen</div>
                                                    </div>
                                                    
                                                    <div className="bg-gradient-to-br from-pink-500 to-pink-600 p-6 rounded-xl text-white">
                                                        <div className="text-3xl mb-2">üí≥</div>
                                                        <div className="text-2xl font-bold">
                                                            ‚Ç¨{analysisData.length > 0 ? (analysisData.reduce((sum, d) => sum + d.sandrineExpenses, 0) / analysisData.length).toFixed(0) : '0'}
                                                        </div>
                                                        <div className="text-pink-100 text-sm">Gem. Maanduitgaven</div>
                                                    </div>
                                                    
                                                    <div className="bg-gradient-to-br from-emerald-500 to-emerald-600 p-6 rounded-xl text-white">
                                                        <div className="text-3xl mb-2">üíé</div>
                                                        <div className="text-2xl font-bold">
                                                            ‚Ç¨{analysisData.length > 0 ? (analysisData.reduce((sum, d) => sum + d.sandrineSavings, 0) / analysisData.length).toFixed(0) : '0'}
                                                        </div>
                                                        <div className="text-emerald-100 text-sm">Gem. Besparingen</div>
                                                    </div>
                                                    
                                                    <div className="bg-gradient-to-br from-indigo-500 to-indigo-600 p-6 rounded-xl text-white">
                                                        <div className="text-3xl mb-2">üìä</div>
                                                        <div className="text-2xl font-bold">
                                                            {analysisData.length > 0 ? (analysisData.reduce((sum, d) => sum + d.sandrineRatio, 0) / analysisData.length).toFixed(1) : '0'}%
                                                        </div>
                                                        <div className="text-indigo-100 text-sm">Gem. Inkomensaandeel</div>
                                                    </div>
                                                </div>

                                                {/* Sandrine Data Table */}
                                                {analysisData.length > 0 ? (
                                                    <div className="bg-white p-6 rounded-xl shadow-lg">
                                                        <h4 className="text-lg font-semibold mb-4">Sandrine - Maandelijkse Data</h4>
                                                        <div className="overflow-x-auto">
                                                            <table className="w-full text-sm">
                                                                <thead className="bg-gray-50">
                                                                    <tr>
                                                                        <th className="text-left p-3 font-semibold">Maand</th>
                                                                        <th className="text-right p-3 font-semibold">Inkomen</th>
                                                                        <th className="text-right p-3 font-semibold">Uitgaven</th>
                                                                        <th className="text-right p-3 font-semibold">Besparingen</th>
                                                                        <th className="text-right p-3 font-semibold">Aandeel</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    {analysisData.slice().reverse().map((month, index) => (
                                                                        <tr key={month.monthKey} className={index % 2 === 0 ? 'bg-gray-50/50' : ''}>
                                                                            <td className="p-3 font-medium">{month.fullMonth}</td>
                                                                            <td className="p-3 text-right">‚Ç¨{month.sandrineIncome.toFixed(2)}</td>
                                                                            <td className="p-3 text-right text-red-600">‚Ç¨{month.sandrineExpenses.toFixed(2)}</td>
                                                                            <td className={`p-3 text-right font-semibold ${month.sandrineSavings >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                                                                ‚Ç¨{month.sandrineSavings.toFixed(2)}
                                                                            </td>
                                                                            <td className="p-3 text-right">{month.sandrineRatio.toFixed(1)}%</td>
                                                                        </tr>
                                                                    ))}
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                ) : null}
                                            </div>
                                        )}

                                        {analysisTab === 'olivier' && (
                                            <div className="space-y-6">
                                                {/* Olivier Overview */}
                                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                                    <div className="bg-gradient-to-br from-green-500 to-green-600 p-6 rounded-xl text-white">
                                                        <div className="text-3xl mb-2">üí∞</div>
                                                        <div className="text-2xl font-bold">
                                                            ‚Ç¨{analysisData.length > 0 ? (analysisData.reduce((sum, d) => sum + d.olivierIncome, 0) / analysisData.length).toFixed(0) : '0'}
                                                        </div>
                                                        <div className="text-green-100 text-sm">Gem. Maandinkomen</div>
                                                    </div>
                                                    
                                                    <div className="bg-gradient-to-br from-orange-500 to-orange-600 p-6 rounded-xl text-white">
                                                        <div className="text-3xl mb-2">üí≥</div>
                                                        <div className="text-2xl font-bold">
                                                            ‚Ç¨{analysisData.length > 0 ? (analysisData.reduce((sum, d) => sum + d.olivierExpenses, 0) / analysisData.length).toFixed(0) : '0'}
                                                        </div>
                                                        <div className="text-orange-100 text-sm">Gem. Maanduitgaven</div>
                                                    </div>
                                                    
                                                    <div className="bg-gradient-to-br from-teal-500 to-teal-600 p-6 rounded-xl text-white">
                                                        <div className="text-3xl mb-2">üíé</div>
                                                        <div className="text-2xl font-bold">
                                                            ‚Ç¨{analysisData.length > 0 ? (analysisData.reduce((sum, d) => sum + d.olivierSavings, 0) / analysisData.length).toFixed(0) : '0'}
                                                        </div>
                                                        <div className="text-teal-100 text-sm">Gem. Besparingen</div>
                                                    </div>
                                                    
                                                    <div className="bg-gradient-to-br from-cyan-500 to-cyan-600 p-6 rounded-xl text-white">
                                                        <div className="text-3xl mb-2">üìä</div>
                                                        <div className="text-2xl font-bold">
                                                            {analysisData.length > 0 ? (analysisData.reduce((sum, d) => sum + d.olivierRatio, 0) / analysisData.length).toFixed(1) : '0'}%
                                                        </div>
                                                        <div className="text-cyan-100 text-sm">Gem. Inkomensaandeel</div>
                                                    </div>
                                                </div>

                                                {/* Olivier Data Table */}
                                                {analysisData.length > 0 ? (
                                                    <div className="bg-white p-6 rounded-xl shadow-lg">
                                                        <h4 className="text-lg font-semibold mb-4">Olivier - Maandelijkse Data</h4>
                                                        <div className="overflow-x-auto">
                                                            <table className="w-full text-sm">
                                                                <thead className="bg-gray-50">
                                                                    <tr>
                                                                        <th className="text-left p-3 font-semibold">Maand</th>
                                                                        <th className="text-right p-3 font-semibold">Inkomen</th>
                                                                        <th className="text-right p-3 font-semibold">Uitgaven</th>
                                                                        <th className="text-right p-3 font-semibold">Besparingen</th>
                                                                        <th className="text-right p-3 font-semibold">Aandeel</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    {analysisData.slice().reverse().map((month, index) => (
                                                                        <tr key={month.monthKey} className={index % 2 === 0 ? 'bg-gray-50/50' : ''}>
                                                                            <td className="p-3 font-medium">{month.fullMonth}</td>
                                                                            <td className="p-3 text-right">‚Ç¨{month.olivierIncome.toFixed(2)}</td>
                                                                            <td className="p-3 text-right text-red-600">‚Ç¨{month.olivierExpenses.toFixed(2)}</td>
                                                                            <td className={`p-3 text-right font-semibold ${month.olivierSavings >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                                                                ‚Ç¨{month.olivierSavings.toFixed(2)}
                                                                            </td>
                                                                            <td className="p-3 text-right">{month.olivierRatio.toFixed(1)}%</td>
                                                                        </tr>
                                                                    ))}
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                ) : null}
                                            </div>
                                        )}
                                    </div>

                                    {/* Manual Sync Button */}
                                    {isGoogleAuthorized && (
                                        <div className="flex justify-center">
                                            <button
                                                onClick={saveToGoogleSheets}
                                                disabled={isSyncing || !isOnline}
                                                className="flex items-center gap-2 px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                                            >
                                                {isSyncing ? (
                                                    <>
                                                        <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                                                        Synchroniseren...
                                                    </>
                                                ) : (
                                                    <>
                                                        üîÑ Handmatig synchroniseren
                                                    </>
                                                )}
                                            </button>
                                        </div>
                                    )}

                                    {/* No Data Message */}
                                    {analysisData.length === 0 && (
                                        <div className="text-center py-16 bg-white rounded-xl shadow-lg">
                                            <div className="text-6xl mb-4">üìä</div>
                                            <h3 className="text-2xl font-bold text-gray-600 mb-4">Nog geen data om te analyseren</h3>
                                            <p className="text-gray-500 mb-8">
                                                Voeg eerst inkomsten en uitgaven toe in de Budget tab om prachtige analyses te zien!
                                            </p>
                                            <button
                                                onClick={() => setActiveTab('budget')}
                                                className="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"
                                            >
                                                Ga naar Budget
                                            </button>
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>

                        {/* Footer Info */}
                        <div className="px-8 pb-6">
                            <div className="bg-gradient-to-r from-gray-50 to-gray-100 p-4 rounded-lg">
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600">
                                    <div>
                                        <strong className="text-gray-800">Data Opslag:</strong>
                                        <br />In browser sessie + Google Sheets backup
                                    </div>
                                    <div>
                                        <strong className="text-gray-800">Auto-Sync:</strong>
                                        <br />Wijzigingen worden automatisch opgeslagen naar Google Sheets
                                    </div>
                                    <div>
                                        <strong className="text-gray-800">Status:</strong>
                                        <br />
                                        {googleApiLoaded ? 'Google Sheets API OK' : 'Google Sheets API Loading...'}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<BudgetCalculator />, document.getElementById('root'));
    </script>
</body>
</html>
